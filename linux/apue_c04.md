
## 第四章 文件和目录

### 学习记录

本章的"枯燥" 程度就有些高了, 看了两周, 都看不下去. 信息量也有些大. 但大多都是熟悉的, 看得时候不上心. 

### 总结

### 习题与问题
1. 用stat函数替换图4-3程序中的lstat函数, 如若命令行参数之一是符号链接, 会发生什么变化? 

2. 如果文件模式创建屏蔽字是777(八进制), 结果会怎样? 用shell的umask命令验证该结果. 

3. 关闭一个你所拥有的用户读权限, 将导致拒绝访问自己的文件, 对此进行验证.

4. 创建文件foo和bar后, 运行图4-9的程序, 将发生什么情况?

5. 4.12节中讲到一个普通文件的大小可以为0, 同时我们又知道st_size 字段是为目录或符号链接定义的, 那么目录和符号链接长度是否可以为0? 

6. 编写一个类似cp(1)的程序, 它复制包含空洞的文件, 但不将字节0写到输出文件中去. 

7. 在4.12号ls命令的输出中, core 和 core.copy 的访问权限不同, 如果创建两个文件时umask没有变, 说明为什么会发生这种差别. 

8. 在运行图 4-16 的程序时, 使用了df(1)命令来检查空闲的磁盘空间. 为什么不使用du(1)命令? 

9. 图 4-20 中显示unlink函数会修改文件状态更改时间, 这是怎样发生的? 

10. 4.22 节中, 系统对可以打开文件数的限制对myftw函数会产生怎样的影响? 

11. 在4.22节中的myftw 从不改变其目录, 对这种处理方法进行改动: 每次遇到一个目录就用其调用chdir, 这样每次调用lstat时就可以使用文件名而非路径名, 处理完所有的目录项后执行 chdir(".."). 比较这种版本的程序和书中程序的运行时间. 

12. 每个进程都有一个根目录用于解析绝对路径名, 可以通过chroot函数改变根目录. 在手册中查询此函数. 说明这个函数什么时候可调用?

13. 如何只设置两个时间值中的一个来使用 utimes 函数. 

14. 有些版本的finger(1)命令输出"New mail received.." 和 "unread since..", 其中..表示相应的日期和时间. 程序是如何决定这些日期和时间的? 

15. 用cpio(1) 和 tar(1)命令检查档案文件的格式(请参阅<Unix程序员手册>第55部分中的说明). 3个可𩢺的时间值中哪几个是为每一个文件保存的? 你认为文件复原时, 文件的访问时间是什么? 为什么?

16. Unix 系统对目录树的深度有限制吗? 编写一个程序循环, 在每次循环中, 创建目录, 并将该目录更改为工作目录. 确保叶节点的绝对路径长度大于系统的 PATH_MAX 限制. 可以调用getcwd 得到目录的路径名吗? 标准unix 系统工具是如何处理长度路径名的? 对目录可以使用tar 或 cpio命令归档吗? 

17. 3.16 节中描述的 /dev/fd 特征. 如果每个用户都可以访问这些文件, 则其访问权限必须为rw-rw-rw-. 有些程序创建输出文件时,先删除该文件以确保该文件名不存在, 忽略返回码. 
```
	unlink(path);
	if ((fd = creat(path, FILE_MODE))<0)
		err_sys(...);
```
如果path是/dev/fd/1, 会出现什么情况? 

18. 文件的属性, 操作命令

