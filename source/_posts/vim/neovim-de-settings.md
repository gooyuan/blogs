---
title: neovim 开发环境配置
date: 2020-07-27 20:43:31
tags: 
- vim
- nvim
categories: 
- vim
description: neovim 是源自vim的，那么，为何不能vim与neovim共用一套呢？ 本文主要以分析skywind3000/vim 来学习搭建c/c++ 开发环境，学习vim 配置，然后同时应用于vim 与nvim，记录此思考过程，总结vim 学习更合适的路线。 skywind3000/vim 的配置就是跨平台的，vim, nvim, linux, windows, FreeBSD, 真得是很牛逼了。 
---

## 背景

写此文档之前，使用vim已经有5年的时间了，知道vim脚本是什么回事，会简单修改，但不会开发。 基本上软件开发, 都使用vim插件，记录文档，也都使用vim。 所以， vim 基本的使用熟练度是有了，宏使用的频率也很高，结合shell命令的操作也让我感受到了vim的高效与灵活。除了使用门槛高，在习惯使用后，个人觉得总体效率还是有所提高的。

门槛高，也是真得高。用了这么长时间， 任一语言的开发环境没搞定, snippet 插件没搞定，学习新插件困难，使用的上的插件也是依着[高人](https://github.com/skywind3000/vim) 的配置, 达到简单的使用。所以, 现在还不能完全使用vim 进行日常开发。
只能在IDE中使用vim 插件开发。

灵活性, 那也是真得灵活。脚本, 插件可以满足任意的定制， 可玩性很高， 也确实能提高效率。 

我个人是推荐学习 vim 的, 那么为何我再使用了五年还是这样的一个水平呢？ 

主要有两点原因：
学习成本高，特别是对于编程初学者来说，想要搭成一个成熟的开发环境，熟练使用vim, 真不是一天两天就可以搞定的，而我的编程是半路出家，毕业才开始接触，工作还是以生存为主，更主要的任务是学习开发技能，计算机技术要学习的东西太多了，因此工具的首要目标是能用, 后面才是断断续续的注重工具效率的提升。
我往往折腾vim, 有的连续的时间顶多不过2,3个小时，折腾不出个所以然，连个插件都使用不起来，对于断断续续的状态， 目标规划阤不明确， 或因工作deadline压迫，或因自身的懒惰，心态经常失衡，再加上IDE配合vim插件，基本上也能体现到编程打字的快感 ，驱动力不足， 于是慢慢悠悠用到现在， 也还是个半吊子的vim水平。 

为何我又要学习vim呢？ 

最直接的原因是，我在linux下发， 阅读android 源码，环境使用不熟练， 看源码很受限(变量, 函数跟踪不了，调用栈分析不了), 且是服务器环境,靠ssh连接不得不使用vim。 学习图形学，算法的时候，学习其他语言的时候， 写博客，markdown的时候，不想换一个软件又一个软件的。虽然vim还处于半吊子水平， 但是vim确实帮助我提升了效率，带来了爽的体验。

当然学习vim依然有情怀加成，能折腾vim的人， 也必然不怕折腾其他编程技术。

编程的本质是相通的， 折腾vim的过程本来就是学习的过程，学习工具的思想，优化工作流，各种插件工具的学习、开发、定制， 必然会对语言的编译，命令的执行，计算机的原理，程序的本质有更深的了解。
搭环境是是开发的基本功，现在的互联网不鼓励个人英雄主义，主张团队合作。而现实所谓的团队合作大多数都是螺丝钉的活，我觉得这是资本为了规避风险所用的策略。
团队合作当然重要，个人力量有限，很难靠个人力量完成大型系统。但是这个团队必然得有一个掌握大局的人来统筹协作。
虽然是拧螺丝的工作，但是有大局观的团队，在协作拧螺丝的过程也必然更高效。我认为每个人都应该向着统筹大局的能力是扩展提升的。
不管是为了抗风险，还是独立完成一款产品的成就感，全面的个人能力是有必要的。
而vim 折腾就涉及到软件开发的全流程。

VIM虽然是一个上古编辑器，然而它仍然是一个优秀的编辑器，优秀的值得一学的编辑器。

优秀是有门槛的，IDE能满足大部分人的需求， 然而并不能带来极限的体验。当然，可能每个人的极限也不一样，所以，无所谓争哪个编辑器好或是不好。

如何优秀呢？ 

	随着不断的学习, 能不断突破个人的极限体验。当然个人体验嘛也是主观性很强的因素，我也无意于去安利谁去使用vim, 我是遵循适合自己的就是好的这一原则，什么都是工具嘛。

闲话少谈，更多关于软件开发的想法，记录在{% post_link thought/thinking-about-programming %} 里

### 基本配置

> nvim 是 fork vim 的项目，去掉了gui的代码与历史积累的代码，更加遵重开源的开发方式。 除了配置路径改变了， 绝大多数的配置是通用的, 因此资料可以互相参考。

网上的vim 配置教程大都只是配置一些插件，注释说明选项什么意思， 这样的教程就落了下乘，因为我按那些大神的vim配置用了这么多年，还是个半吊子水平， 当然，这跟我自己的学习态度也有关系。直接`:help` 看 vim文档，英文能力也有限，经常效率不高，就睡着了(提升英文能力很重要, 这是后话，另作他表)。 对于一个没有编程经验的小白来说，一个好的本土语言的教程，确实能帮助期少走很多变路。 

现在有了一些开发经验后，再学习vim, 就相对容易一些。 
一个系统(提供了插件扩展能力的应用都可以以称作一个系统)必然会提供一个上下文环境，上下文环境又是与生命周期概念， 所以，学习vim配置，最好还是从生命周期，上下文环境(运行时环境)，插件的加载层次这些信息来入手，更加能抓住主干核心， 对于学习新插件，自己开发插件， 也是必不可少的。 

意识到这个问题， 当然是先搜索是否已有人已经写过了相关问题， 找到如下blog, 解答了我的疑惑
[vim配置层次结构与插件加载方式(一)](https://blog.csdn.net/qq_27825451/article/details/100518128)
[vim8原生内置(naive)插件安装（二）](https://blog.csdn.net/qq_27825451/article/details/100557133)

`:help initialization` 可以查看启动流程文档。

`:scriptnames` 可以查看加载了哪些脚本， 通过脚本的路径可以查看到vim 会加载哪些路径下的脚本，
`:set runtimepath` 也可以查看运行时加载路径，以逗号分隔。
使用 `vim -V` 可以查看vim 启动信息, 

然而还是不清楚哪些是默认加载的， 哪些是通过脚本配置加载的。 
通过 `:help runtimepath` 可以查看详细内容

	* Plugin
		“全局插件", 会自动加载的vim 脚本文件

	* autoload
		(与plugin 不一样) 此文件夹下的脚本只有在调用的时候才会加载, # 相当于路径一样使用
		[示例](https://www.w3cschool.cn/vim/xenarozt.html)

	* ftdetect
		可以自定义识别文件类型, 具体查看 :help ftdetect

	* ftplugin
		编辑已知文件类型是执行的脚本

	* compiler
		定义如何运行各种编译工具或格式化工具，以及如何解析其输出。 可以在多个ftplugins间共享。且不会自动执行，必须通过 `:compiler`调用

	* pack
		Vim8 原生软件包目录， 采用了 "Pathogen" 格式的包管理。 

pack 原生包管理个人觉得没必要使用， vim-plugin 就很好用, 但是了解一下有必要， 用于学习其他大神的配置文件。 

了解了vim 启动加载生命周期， 是主要是阅读他人的配置，这里我首先参考的是[theniceboy/nvim](https://github.com/theniceboy/nvim)和[skywind3000/vim](https://github.com/skywind3000/vim)的配置，学习并定制自己的配置， 做到每一行配置都知其作用。 定制符合自身习惯的配置。

基本配置的思路:

1. 默认变量
	设置默认变量的变量通过 set 命令, `=` 号两边不能有空格
	查看所有的默认变量通过 `:options`命令
	查看每个变量的详细介绍通过 `:help <variant>` 命令

2. 快捷键
	快捷键的本质思想是将常用的，较复杂(超过3次按键)的操作简化成键程更短, 双手配合更方便的两键,三键或四键。
	
	快捷键涉及到的命令字有: 

	|命令字|备注|
	|:--:|:--:|
	|map| 递归的映射|
	|unmap|删除某个映射|
	|mapclear| 清除映射 |
	|noremap|no recursive map, 非递归的|
	|inoremap| insert  模式下 |
	|nnoremap| normal  模式下 |
	|vnoremap| visual  模式下 |
	|cnoremap| command 模式下 |
	|snoremap|  |
	|slient| |
	|autocmd| 事件监听命令，一般格式为 <br/>:autocmd [group] {events} {file_pattern} [++nested] {command} |
	|<tab> |
	|<CR>  |

3. 函数

	这就涉及到更具体的开发技能了，脚本语言在nvim 更加开放。
	函数的编写先不必强求，可以看懂个大概, 先将别人的用起来， 待互联网搜索满足不了需求的时候，再思考着去定制。 
	vim 的插件也是定制函数的集合

折腾了一番， 最终还是觉得 skywind3000 的配置要牛逼得多， 不论是架构, 还是功能完善程度。

之前已经尝试过从解读源码来学习韦易笑大婶的配置，详情请点{% post_link cpp_env_setting %}, 当时能力有限，很多配置还是看不懂。经过这一番折腾感觉自己好像又能看懂源码了， 那么继续站在前辈的肩膀上继续学习vim吧。 

决定继续分析`skywind3000/vim`框架，定一个小目标: 在分析其源码的同时， 更新完善readme文件, 然后提PR。

更主要的是将学习vim, 分析的思路记录下来， 以便于抓住学习的本质， 帮助更多的初学者， 降低学习vim的门槛。

又发现了 skywind3000 又配置了一个[vim-init](https://github.com/skywind3000/vim-init)供新手学习， 这可是真得很友好了，韦易笑大婶真是非常良心了。
结合这个初学者的项目， 系统的学习一下vim。

### 如何看手册

记录手册中的一些规则，真正学起来，vim 也不是那么难了, 最主要的还是为什么要学的问题。解决不了为什么要学的问题，就很难静下心来，花一两个月的时间去系统的学习， 因此，在使用的过程中就完全受阻了。 

[vim 文档中文手册](https://github.com/yianwillis/vimcdoc)

在收集资料的过程中， 发现了那么多人为vim 学习与普及做了很多工作，为何使用vim的人还那么少呢？ 
这其实就与个人态度有关了。 大部分人的工作情况都是能用就行， 完成工作了， 不工作的时间就是自己的时间了, 因此，很多工作之外的工作，就与我无关了。然而， vim 能提升的工作效率，也是非常可观的， 我个人觉得， 工作与生活，没有必要刻意地完全的分开，也不可能完全割裂开, 工作本就是生活中的一部分。
我一贯主张的理念是条条大路通罗马，知识的理念是相通的，学习是一辈子的事情，所以，生命中做得每一件事，都是学习的途径，都值得去思考。
学习是消耗精力的，所以大脑在很多时候就会将学习趋向于习惯，因此会形成舒适区。
大脑将学习的过程趋向于习惯，这在一开始的时候的表现大多都是懒与拖延症，因为开始学习某项技能的时候，相关领域的未知知识是最多的，脑力的消耗也是最多的。接受这一事实， 在开始的时候，跳出舒适区相对来说就没有那么痛苦了，因为心中有底，相信过一段时间就会有所改善。 随着技能积累的多了，排列组合的可能就多了，因此创新的方向就多了。这是知识良性正循环。 

得， 又说了这么多的“闲话”, 继续回到 vim 手册查看的注意事项上来。
linux 下各种软件的手册，会有很多约定， 而这些约定不反应在手册里，因此会造成看手册的障碍，我这里就记录一下我所知的一些约定。 

1. 命令行中的约定

|符号| 说明|
|:-:|:--:|
| [ ] | 该参数是选填的，命令中不带[ ],[ ]中的单词是说明 |
| < > | 该参数是必填的，命令中不带< >,< >中的单词是说明 |
| <++> | <++> |
| <++> | <++> |
| <++> | <++> |
| <++> | <++> |

2. 函数介绍中的约定

### vim 的启动流程

`:help initialization` 查看初始化文档

	1. 设置 shell 和 term 选项, 'term' 选项是在第8步用来改变GUI的 
	2. 处理参数， `-V` 参数可以显示日志信息和下一步动作, 方便用来调试启动初始化流程。
	3. 从环境变量或文件中加载可执行命令并执行。`Ex commands`, 是 `exec` 将字符串当作 shell 命令执行
	4. 加载脚本文件
	5. 设置 shellpipe 和 shellredir, shell管道和输出重定向。
	6. 如果带有` -n ` 参数, 将 updatecount 设置为0
	7. 如果带有` -b ` 参数，设置 binary options, 
	8. 执行GUI初始化 (仅作用于gvim启动)
	9. 读 viminfo 文件
	10. 读 quickfix 文件
	11. 打开所有窗口
	12. 如果带有` -c 和 +cmd ` 参数，执行启动命令

	生命周期还涉及 start, after 目录，针对每个插件加载过程

### vim 脚本

[Google Vimscript Style Guide](https://google.github.io/styleguide/vimscriptguide.xml)

`:help usr_41` 命令

如何让vim 与 nvim 使用同一个配置？ 

	将nvim 的执行环境修改成vim 的, 类似于chroot的原理。

	打开nvim, 输入 `:help nvim-from-vim` 有帮助文档

	1. 创建`~/.config/nvim/init.vim` 文件
	2. 添加下例内容到 init.vim
```vimrc

	# ^= 将~/.vim 添加到runtimepath之前，after 是用来覆盖缺省值或增加设置(很少用到)，这里实际是没有用到, 对应的还有start 生命周期
	set runtimepath^=~/.vim runtimepath+=~/.vim/after

	# &是取选项值，packpath 是vim 默认插件存放位置, 所有 pack/*/opt/{name}/plugin/**/*.vim 文件都被执行, 这样可以允许"plugin"使用子目录，像 `runtimepath` 里的插件一样。
	let &packpath = &runtimepath

	source ~/.vimrc
```
	3. 重启nvim, 就会加载vim 配置了
		

### c/c++ 环境配置

### 插件介绍

|插件名称|作用说明|
|:--:|:--:|
| <++> | <++> |
| <++> | <++> |
| <++> | <++> |
| <++> | <++> |
| <++> | <++> |
| <++> | <++> |
| <++> | <++> |
| <++> | <++> |
| <++> | <++> |
| <++> | <++> |
| <++> | <++> |
| <++> | <++> |
| <++> | <++> |
| <++> | <++> |
| <++> | <++> |
| <++> | <++> |
| <++> | <++> |
| <++> | <++> |
| <++> | <++> |
| <++> | <++> |
| <++> | <++> |
| <++> | <++> |
| <++> | <++> |
| <++> | <++> |
| <++> | <++> |
| <++> | <++> |
| <++> | <++> |
| <++> | <++> |
| <++> | <++> |
| <++> | <++> |
| <++> | <++> |
| <++> | <++> |
| <++> | <++> |
| <++> | <++> |
| <++> | <++> |
| <++> | <++> |
| <++> | <++> |
| <++> | <++> |
| <++> | <++> |
| <++> | <++> |
| <++> | <++> |
| <++> | <++> |
| <++> | <++> |
| <++> | <++> |
| <++> | <++> |
| <++> | <++> |
| <++> | <++> |
| <++> | <++> |
| <++> | <++> |
| <++> | <++> |
| <++> | <++> |

### 关于插件学习的思考

### 关于
